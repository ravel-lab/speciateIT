# Makefile for all2kmerStats

CC       = clang
CXX      = clang
LINK     = clang
LDFLAGS  = -std=c++17 -lc++abi -lstdc++
FLAGS    = -g -Wall -D__SIM_SSE3 -msse3 -O2 -dynamic -fomit-frame-pointer -funroll-loops -D__AVX -pedantic -Wunused -Wunused-variable -Wunused-value -Wunused-function -Wunused-label -Wredundant-decls -Wreturn-type
CFLAGS   = $(FLAGS)
CXXFLAGS = -std=c++17 $(FLAGS)
LIBS     = -lm
SRCDIR   = /Users/pgajer/devel/speciateIT/src
#INCPATH  = -I$(SRCDIR) -I/Users/pgajer/devel/speciateIT/csv-parser/single_include
INCPATH  = -I$(SRCDIR) -I/Users/pgajer/devel/speciateIT/include
DEL_FILE = rm -f
SYMLINK  = ln -sf
DEL_DIR  = rmdir
MOVE     = mv -f
CHK_DIR_EXISTS = test -d
MKDIR    = mkdir -p

####### Files

BINDIR  = .
BUILDDIR= .build

create-build-dir := $(shell $(CHK_DIR_EXISTS) $(BUILDDIR) || $(MKDIR) $(BUILDDIR))

OBJECTS = $(BUILDDIR)/emd_test.o \
          $(BUILDDIR)/CUtilities.o \
          $(BUILDDIR)/emd.o \
          $(BUILDDIR)/CStatUtilities.o \
          $(BUILDDIR)/CppStatUtilities.o

####### Build rules

emd_test: $(OBJECTS)
	$(LINK) $(OBJECTS) $(LDFLAGS) -o $(BINDIR)/emd_test

$(BUILDDIR)/emd_test.o: emd_test.cc
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(BUILDDIR)/emd_test.o emd_test.cc

$(BUILDDIR)/CUtilities.o: $(SRCDIR)/CUtilities.c
	$(CC) -c $(CFLAGS) $(INCPATH) -o $(BUILDDIR)/CUtilities.o $(SRCDIR)/CUtilities.c

$(BUILDDIR)/emd.o: $(SRCDIR)/emd.c
	$(CC) -c $(CFLAGS) $(INCPATH) -o $(BUILDDIR)/emd.o $(SRCDIR)/emd.c

$(BUILDDIR)/CppStatUtilities.o: $(SRCDIR)/CppStatUtilities.cc
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $(BUILDDIR)/CppStatUtilities.o $(SRCDIR)/CppStatUtilities.cc

$(BUILDDIR)/CStatUtilities.o: $(SRCDIR)/CStatUtilities.c
	$(CC) -c $(CFLAGS) $(INCPATH) -o $(BUILDDIR)/CStatUtilities.o $(SRCDIR)/CStatUtilities.c



clean:
	-$(DEL_FILE) $(OBJECTS)
